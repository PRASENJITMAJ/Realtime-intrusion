import os
import pandas as pd
import numpy as np

# ğŸ”§ Set this to your actual dataset folder
DATASET_FOLDER = "/Users/radha-krishna1060/Desktop/RealTime_IDS/Dataset"

# ğŸ” Get all CSV file paths
csv_files = [os.path.join(DATASET_FOLDER, f) for f in os.listdir(DATASET_FOLDER) if f.endswith('.csv')]
print(f"Found {len(csv_files)} CSV files.")

# ğŸ“¦ Accumulate cleaned DataFrames
df_list = []

for file in csv_files:
    print(f"\nğŸ“ Loading: {file}")
    df = pd.read_csv(file, low_memory=False)
    
    # ğŸ§¹ Clean column names
    df.columns = df.columns.str.strip()
    
    # ğŸ§¼ Remove rows with NaN or inf
    df.replace([np.inf, -np.inf], np.nan, inplace=True)
    df.dropna(inplace=True)
    
    # ğŸ§½ Remove duplicates
    df.drop_duplicates(inplace=True)
    
    # ğŸ”¤ Fix label formatting
    if 'Label' in df.columns:
        df['Label'] = df['Label'].astype(str).str.strip()
        df['Label'] = df['Label'].str.replace(r'[^\w\s]', '', regex=True)
    else:
        print("âš ï¸ No 'Label' column found. Skipping file.")
        continue
    
    # ğŸ¯ Convert labels to binary
    df['AttackLabel'] = df['Label'].apply(lambda x: 0 if x.upper() == 'BENIGN' else 1)

    df_list.append(df)

# ğŸ§¬ Merge all into one DataFrame
full_df = pd.concat(df_list, ignore_index=True)

# ğŸ§¾ Save cleaned dataset
output_file = os.path.join(DATASET_FOLDER, "cleaned_dataset.csv")
full_df.to_csv(output_file, index=False)
print(f"\nâœ… Cleaned dataset saved as: {output_file}")
print(f"ğŸ§® Final shape: {full_df.shape}")
print(f"ğŸ“Š Label distribution:\n{full_df['AttackLabel'].value_counts()}")
